<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=9; IE=8; IE=7; IE=EDGE">
	<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7" />
	<title>设置-个人信息</title>
	<link rel="icon" href="./img/favicon.ico">

	<link rel="stylesheet" type="text/css" href="./css/all.css" />
	<link rel="stylesheet" type="text/css" href="./css/pages-seckillOrder.css" />
<!--	<link rel="stylesheet" type="text/css" href="./css/pages-addressbootstrap.css"/>-->
	<link rel="stylesheet" type="text/css" href="./css/pages-addresscity-picker.css"/>
	<link rel="stylesheet" type="text/css" href="./css/pages-addressmain.css"/>
</head>

<body>
<!-- 头部栏位 -->
<!--页面顶部-->
<div id="head"></div>
<!--header-->
<div id="account">
	<div class="py-container">
		<div class="yui3-g home">
			<!--左侧列表-->
			<div class="yui3-u-1-6 list">

				<div class="person-info">
					<div class="person-photo"><img src="./img/_/photo.png" alt=""></div>
					<div class="person-account">
						<span class="name">Michelle</span>
						<span class="safe">账户安全</span>
					</div>
					<div class="clearfix"></div>
				</div>
				<div class="list-items">
					<dl>
						<dt><i>·</i> 订单中心</dt>
						<dd ><a href="center-index.html" >我的订单</a></dd>
						<dd><a href="center-order-pay.html" >待付款</a></dd>
						<dd><a href="center-order-send.html"  >待发货</a></dd>
						<dd><a href="center-order-receive.html" >待收货</a></dd>
						<dd><a href="center-order-evaluate.html"  >待评价</a></dd>
					</dl>
					<dl>
						<dt><i>·</i> 我的中心</dt>
						<dd><a href="center-collect.html">我的收藏</a></dd>
						<dd><a href="center-footmark.html" >我的足迹</a></dd>
					</dl>
					<dl>
						<dt><i>·</i> 物流消息</dt>
					</dl>
					<dl>
						<dt><i>·</i> 设置</dt>
						<dd><a href="center-setting-info.html">个人信息</a></dd>
						<dd><a href="center-setting-address.html" class="list-active" >地址管理</a></dd>
						<dd><a href="center-setting-safe.html" >安全管理</a></dd>
					</dl>
				</div>
			</div>
			<!--右侧主内容-->
			<div class="yui3-u-5-6">
				<div class="body userAddress">
					<div class="address-title">
						<span class="title">地址管理</span>
						<a data-toggle="modal" data-target=".edit" data-keyboard="false"   class="sui-btn  btn-info add-new">添加新地址</a>
						<span class="clearfix"></span>
					</div>
					<div class="address-detail">
						<table class="sui-table table-bordered">
							<thead>
							<tr>
								<th>姓名</th>
								<th>地址</th>
								<th>联系电话</th>
								<th>操作</th>
							</tr>
							</thead>
							<tbody class="add_data">
							<!--地址内容处!	-->
<!--							<tr title="1">-->
<!--								<td name="contact" title="1">刘田田</td>-->
<!--								<td name="address">北京 北京市 海淀区 上地街道东北旺西路8号中关村软件园9号楼</td>-->
<!--								<td name="mobile">1774***********4</td>-->
<!--								<td>-->
<!--									<a class="edit-modify XiuGai_1" data-toggle="modal" data-target=".edit" data-keyboard="false" href="#">编辑</a>-->
<!--									<a class="edit-modify ShanChu_1" href="#">删除</a>-->
<!--									默认地址-->
<!--								</td>-->
<!--							</tr>-->
<!--							<tr title="2">-->
<!--								<td name="contact" title="1">沈沉</td>-->
<!--								<td name="address">北京 北京市 海淀区 上地街道东北旺西路8号中关村软件园9号楼</td>-->
<!--								<td name="mobile">1774***********4</td>-->
<!--								<td>-->
<!--									<a class="edit-modify XiuGai_1" data-toggle="modal" data-target=".edit" data-keyboard="false" href="#">编辑</a>-->
<!--									<a class="edit-modify ShanChu_1" href="#">删除</a>-->
<!--									<a href="#">设为默认</a>-->
<!--								</td>-->
<!--							</tr>-->
							</tbody>
						</table>
					</div>
					<!--新增地址弹出层-->
					<div  tabindex="-1" role="dialog" data-hasfoot="false" class="sui-modal hide fade edit" style="width:580px;">
						<div class="modal-dialog">
							<div class="modal-content">
								<div class="modal-header">
									<button type="button" data-dismiss="modal" aria-hidden="true" class="sui-close">×</button>
									<h4 id="myModalLabel" class="modal-title">新增地址</h4>
								</div>
								<div class="modal-body">
									<form action="" class="sui-form form-horizontal">
										<div class="control-group">
											<label class="control-label">收货人：</label>
											<div class="controls">
												<input type="text" name="contact" class="input-medium input_name">
											</div>
										</div>
										<div class="control-group">
											<label class="control-label">所在地区：</label>
											<div class="controls">
												<!--                                                <div data-toggle="distpicker">-->
												<!--                                                <div class="form-group area">-->
												<!--                                                    <select class="form-control" id="province1"></select>-->
												<!--                                                </div>-->
												<!--                                                <div class="form-group area">-->
												<!--                                                    <select class="form-control" id="city1"></select>-->
												<!--                                                </div>-->
												<!--                                                <div class="form-group area">-->
												<!--                                                    <select class="form-control" id="district1"></select>-->
												<!--                                                </div>-->
												<div class="docs-methods">
<!--													<form class="form-inline">-->
														<div id="distpicker">
															<div class="form-group">
																<div style="position: relative;">
																	<input id="city-picker3" name="address" class="form-control" readonly type="text" value="" data-toggle="city-picker">
																</div>
															</div>
															<div class="form-group">
																<button class="btn btn-warning" id="reset" type="button">重置</button>
																<button class="btn btn-danger" id="destroy" type="button">确定</button>
															</div>
														</div>
<!--													</form>-->
												</div>
											</div>
										</div>
										<div class="control-group">
											<label class="control-label">详细地址：</label>
											<div class="controls">
												<input type="text" name="address" class="input-large">
											</div>
										</div>
										<div class="control-group">
											<label class="control-label">联系电话：</label>
											<div class="controls">
												<input type="text" name="mobile" class="input-medium input-telephone">
											</div>
										</div>
										<div class="control-group control-development">
										      <label class="control-label">备注：</label>
										        <div class="controls">
										           	<input type="text" name="notes" class="input-medium input-remarks">
										       </div>
										</div>
										<!--                                        <div class="control-group">-->
										<!--                                            <label class="control-label">地址别名：</label>-->
										<!--                                            <div class="controls">-->
										<!--                                                <input type="text" class="input-medium">-->
										<!--                                            </div>-->
										<!--                                            <div class="othername">-->
										<!--                                                建议填写常用地址：<a href="#" class="sui-btn btn-default">家里</a>　<a href="#" class="sui-btn btn-default">父母家</a>　<a href="#" class="sui-btn btn-default">公司</a>-->
										<!--                                            </div>-->
										<!--                                        </div>-->
										<!--                                        -->
									</form>


								</div>
								<div class="modal-footer">
									<button type="button" data-ok="modal" class="sui-btn btn-primary btn-large">确定</button>
									<button type="button" data-dismiss="modal" class="sui-btn btn-default btn-large">取消</button>
								</div>
							</div>
						</div>
					</div>

				</div>
			</div>
		</div>
	</div>
</div>
<!-- 底部栏位 -->
<div id="foot"></div>
<!--页面底部-->
<!--页面底部END-->

<script type="text/javascript" src="./js/jquery.js"></script>
<script type="text/javascript" src="./js/pages/addressBootstrap.js"></script>
<script type="text/javascript" src="./js/pages/addressCity-picker.data.js"></script>
<script type="text/javascript" src="./js/pages/addressCity-picker.js"></script>
<script type="text/javascript" src="./js/pages/addressMain.js"></script>
<script type="text/javascript" src="js/all.js"></script>
<script type="text/javascript" src="admin/assets/layer/layer.js"></script>
<script>
	$("#head").load("include/head.html");
	$("#foot").load("include/foot.html");
</script>
<script>
	$(function () {
		//页面加载时，查询数据添加到页面
		$(document).ready(function(){
			$.ajax({ url:"/address/getConditions", success: function(data){
					inits(data);
				}});
		});
		//从页面地址中获取用户登录时，传出的用户名!
		// $(function () {
		// 	function GetQueryString(name) {
		// 		var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
		// 		var r = window.location.search.substr(1).match(reg);
		// 		if(r!=null)return  unescape(r[2]); return null;
		// 	}
		// 	// 调用方法
		// 	var gqs=GetQueryString("tel");
		//点击新增地址按钮时产生的页面样式
		$(".btn-info").click(function () {
			$(".modal-title").text("新增地址");
			$(".sui-form").attr("action","/address/SetAddress");
			$(".input_name").val("");
			$(".placeholder").val("");
			$(".input-large").val("");
			$(".input-telephone").val("");
			$(".input-remarks").attr("name","notes");
			$(".input-remarks").val("");
			$(".control-development").show();
		});
		//判断电话号码是否符合规格
		$(".input-telephone").blur(function (){
				var telephone=/^\d{11,}$/;
				var telephones=$(this).val();
				if (!telephone.test(telephones)){
					alert("电话号码不对");
					$(this).val("");
				}

		});
		//完成后的判断与传输
		$(".btn-primary").click(function () {
			//用户名获取用户id
			// var userName=null;
			// var userID;
			// $.ajax({ url:"/address/findByuUserId",data:{"name":userName}, success: function(data){
			// 		userID=data;
			// 	}});
			//获取新增数据
			var titles=$(".modal-title").text();
			var names=$(".input_name").val();
			var diZi1=$("#city-picker3").val();
			var diZi2=$(".input-large").val();
			var diZi=diZi1+"/"+diZi2;
			var dianHua=$(".input-telephone").val();
			var beiZu=$(".input-remarks").val();
			//判断数据是否为空
			if (names==null||diZi==null||dianHua==null||beiZu==null){
				alert("请将内容填完才可完成！")
			} else {
				//判断是否是添加还是修改
				if (titles=="新增地址"){
					$.ajax({ url:"/address/SetAddress",data:{"contact":names,"address_1":diZi,"mobile":dianHua,"notes":beiZu}, success: function(data){
							if (data){
								$(".sui-close").click();
								$.ajax({ url:"/address/getConditions", success: function(data){
										inits(data);
									}});
							}
						}});
				} else if (titles=="修改地址"){
					$.ajax({ url:"/address/update",data:{"contact":names,"address_1":diZi,"mobile":dianHua,"id":beiZu}, success: function(data){
							if (data){
								$(".sui-close").click();
								$.ajax({ url:"/address/getConditions", success: function(data){
										inits(data);
									}});
							}
						}});
				}
			}
		});
		//页面样式设置
		function inits(data) {
			var tbody=$(".add_data");
			tbody.empty();
			var obj = eval(data);
			$(obj).each(function (index) {
				var val = obj[index];
				tbody.append("<tr title="+val.id+">" +
						"<td name='contact' title="+val.userId+">"+val.contact+"</td>" +
						"<td name='address' title="+val.id+">"+val.address+"</td>" +
						"<td name='mobile'>"+val.mobile+"</td>"+
						"<td><a class='edit-modify XiuGai_1' data-toggle='modal' data-target='.edit' data-keyboard='false' href='#'>编辑</a>" +
						"<a class='edit-modify ShanChu_1' href='#'> 删除</a>" +
						"<a class='default_Sselection' href='#'> 默认地址</a></td></tr>");
				//点击修改时，进行判断修改
				$(".XiuGai_1").click(function () {
					//
					$(".modal-title").text("修改地址");
					$(".sui-form").attr("action","/address/update");
					var id=$($(this).parent().parent().find("td").get(1)).attr("title");
					var contact=$($(this).parent().parent().find("td").get(0)).text();
					var address=$($(this).parent().parent().find("td").get(1)).text();
					var address_s=address.split(" ");
					var address_1=address_s[0].toString()+"/"+address_s[1].toString()+"/"+address_s[2].toString();
					var address_2=address_s[3].toString();
					var mobile=$($(this).parent().parent().find("td").get(2)).text();
					$(".input_name").val(contact);
					$(".placeholder").val(address_1);
					$(".input-large").val(address_2);
					$(".input-telephone").val(mobile);
					$(".input-remarks").attr("name","id");
					$(".input-remarks").val(id);
					$(".control-development").hide();
					//
					$.ajax({ url:"/address/getConditions", success: function(data){
							inits(data);
						}});
				});
				//点击删除时，进行数据删除操作！
				$(".ShanChu_1").click(function () {
					var id=$($(this).parent().parent().find("td").get(1)).attr("title");
					$.ajax({ url:"/address/deleteById",data :{"id":id}, success: function(data){
							if (data){
								$.ajax({ url:"/address/getConditions", success: function(data){
										inits(data);
									}});
							}
						}});
				});
				//点击默认时，修改颜色，没有任何意义！
				$(".default_Sselection").click(function () {
					$(".default_Sselection").removeAttr("style");
					$(this).attr("style","color: black");
				})
			});
		}
		//点击修改时，进行判断修改
		$(".XiuGai_1").click(function () {
			//
			$(".modal-title").text("修改地址");
			$(".sui-form").attr("action","/address/update");
			var id=$($(this).parent().parent().find("div").get(1)).attr("data-title");
			var contact=$($(this).parent().parent().find("div").get(0)).text();
			var address=$($(this).parent().parent().find("div").get(1)).text();
			var address_s=address.split(" ");
			var address_1=address_s[0].toString()+"/"+address_s[1].toString()+"/"+address_s[2].toString();
			var address_2=address_s[3].toString();
			var mobile=$($(this).parent().parent().find("div").get(2)).text();
			$(".input_name").val(contact);
			$(".placeholder").val(address_1);
			$(".input-large").val(address_2);
			$(".input-telephone").val(mobile);
			$(".input-remarks").attr("name","id");
			$(".input-remarks").val(id);
			$(".control-development").hide();
			//
			$.ajax({ url:"/address/getConditions", success: function(data){
					inits(data);
				}});
		});
	})

</script>

</body>

</html>