<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=9; IE=8; IE=7; IE=EDGE">
	<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7" />
	<title>我的购物车</title>
	<link rel="icon" href="./img/favicon.ico">

    <link rel="stylesheet" type="text/css" href="./css/all.css" />
    <link rel="stylesheet" type="text/css" href="./css/pages-cart.css" />
</head>

<body>
	<!--head-->
	<!-- 头部栏位 -->
	<!--页面顶部-->
	<div id="head"></div>
	
	<div class="cart py-container">
		<!--All goods-->
		<div class="allgoods">
			<h4>全部商品<span></span></h4>
			<div class="cart-main">
				<div class="yui3-g cart-th">
					<div class="yui3-u-1-4"><!--<input class="chooseAll" type="checkbox" name="" id="" value="" />--> 全部</div>
					<div class="yui3-u-1-4">商品</div>
					<div class="yui3-u-1-8">单价（元）</div>
					<div class="yui3-u-1-8">数量</div>
					<div class="yui3-u-1-8">小计（元）</div>
					<div class="yui3-u-1-8">操作</div>
				</div>
				<div class="cart-item-list">
					<div class="cart-body">
<!--						<div class="cart-list">-->
<!--							<ul class="goods-list yui3-g">-->
<!--								<li class="yui3-u-1-24">-->
<!--									<input type="checkbox" name="chk_list" name="" id="" value="1" />-->
<!--								</li>-->
<!--								<li class="yui3-u-6-24">-->
<!--									<div class="good-item">-->
<!--										<div class="item-img"><img src="./img/goods.png" /></div>-->
<!--										<div class="item-msg">Apple Macbook Air 13.3英寸笔记本电脑 银色（Corei5）处理器/8GB内存</div>-->
<!--									</div>-->
<!--								</li>-->
<!--								<li class="yui3-u-5-24">-->
<!--									<div class="item-txt">颜色MzcBook爱人 银色（Corei5）处理器/8GB内存 尺寸：13.3英寸</div>-->
<!--								</li>-->
<!--								<li class="yui3-u-1-8"><span class="price">8848.00</span></li>-->
<!--								<li class="yui3-u-1-8">-->
<!--									<a href="javascript:void(0)" class="increment mins">-</a>-->
<!--									<input autocomplete="off" type="text" value="1" minnum="1" class="itxt" />-->
<!--									<a href="javascript:void(0)" class="increment plus">+</a>-->
<!--								</li>-->
<!--								<li class="yui3-u-1-8"><span class="sum">8848.00</span></li>-->
<!--								<li class="yui3-u-1-8">-->
<!--									<a class="cut_out" href="">删除</a><br />-->
<!--									<a href="">移到收藏</a>-->
<!--								</li>-->
<!--							</ul>-->
<!--						</div>-->
<!--						<div class="cart-list">-->
<!--							<ul class="goods-list yui3-g">-->
<!--								<li class="yui3-u-1-24">-->
<!--									<input type="checkbox" name="chk_list" name="" id="" value="2" />-->
<!--								</li>-->
<!--								<li class="yui3-u-6-24">-->
<!--									<div class="good-item">-->
<!--										<div class="item-img"><img src="./img/goods.png" /></div>-->
<!--										<div class="item-msg">Apple Macbook Air 13.3英寸笔记本电脑 银色（Corei5）处理器/8GB内存</div>-->
<!--									</div>-->
<!--								</li>-->
<!--								<li class="yui3-u-5-24">-->
<!--									<div class="item-txt">颜色MzcBook爱人 银色（Corei5）处理器/8GB内存 尺寸：13.3英寸</div>-->
<!--								</li>-->
<!--								<li class="yui3-u-1-8"><span class="price">8848.00</span></li>-->
<!--								<li class="yui3-u-1-8">-->
<!--									<a href="javascript:void(0)" class="increment mins">-</a>-->
<!--									<input autocomplete="off" type="text" value="1" minnum="1" class="itxt" />-->
<!--									<a href="javascript:void(0)" class="increment plus">+</a>-->
<!--								</li>-->
<!--								<li class="yui3-u-1-8"><span class="sum">8848.00</span></li>-->
<!--								<li class="yui3-u-1-8">-->
<!--									<a class="cut_out" href="">删除</a><br />-->
<!--									<a href="">移到收藏</a>-->
<!--								</li>-->
<!--							</ul>-->
<!--						</div>-->
<!--						<div class="cart-list">-->
<!--							<ul class="goods-list yui3-g">-->
<!--								<li class="yui3-u-1-24">-->
<!--									<input type="checkbox" name="chk_list" name="" id="" value="3" />-->
<!--								</li>-->
<!--								<li class="yui3-u-6-24">-->
<!--									<div class="good-item">-->
<!--										<div class="item-img"><img src="./img/goods.png" /></div>-->
<!--										<div class="item-msg">Apple Macbook Air 13.3英寸笔记本电脑 银色（Corei5）处理器/8GB内存</div>-->
<!--									</div>-->
<!--								</li>-->
<!--								<li class="yui3-u-5-24">-->
<!--									<div class="item-txt">颜色MzcBook爱人 银色（Corei5）处理器/8GB内存 尺寸：13.3英寸</div>-->
<!--								</li>-->
<!--								<li class="yui3-u-1-8"><span class="price">8848.00</span></li>-->
<!--								<li class="yui3-u-1-8">-->
<!--									<a href="javascript:void(0)" class="increment mins">-</a>-->
<!--									<input autocomplete="off" type="text" value="1" minnum="1" class="itxt" />-->
<!--									<a href="javascript:void(0)" class="increment plus">+</a>-->
<!--								</li>-->
<!--								<li class="yui3-u-1-8"><span class="sum">8848.00</span></li>-->
<!--								<li class="yui3-u-1-8">-->
<!--									<a class="cut_out" href="#">删除</a><br />-->
<!--									<a href="#">移到收藏</a>-->
<!--								</li>-->
<!--							</ul>-->
<!--						</div>-->
					</div>
				</div>
			</div>
			<div class="cart-tool">
				<div class="select-all">
					<input class="chooseAll" type="checkbox"  name="" id="" value="" />
					<span>全选</span>
				</div>
				<div class="option">
					<a class="totalDelete" href="#none">删除选中的商品</a>
					<a href="#none">移到我的关注</a>
					<a href="#none">清除下柜商品</a>
				</div>
				<div class="money-box">
					<div class="chosed">已选择<span>0</span>件商品</div>
					<div class="sumprice">
						<span><em>总价（不含运费） ：</em><i class="summoney">¥16283.00</i></span>
						<span><em>已节省：</em><i>-¥20.00</i></span>
					</div>
					<div class="sumbtn">
						<a class="sum-btn" href="getOrderInfo.html" target="_blank">结算</a>
					</div>
				</div>
			</div>
			<div class="clearfix"></div>
			<div class="liked">
				<ul class="sui-nav nav-tabs">
					<li class="active">
						<a href="#index" data-toggle="tab">猜你喜欢</a>
					</li>
					<li>
						<a href="#profile" data-toggle="tab">特惠换购</a>
					</li>
				</ul>
				<div class="clearfix"></div>
				<div class="tab-content">
					<div id="index" class="tab-pane active">
						<div id="myCarousel" data-ride="carousel" data-interval="4000" class="sui-carousel slide">
							<div class="carousel-inner">
								<div class="active item">
									<ul>
										<li>
											<img src="./img/like1.png" />
											<div class="intro">
												<i>Apple苹果iPhone 6s (A1699)</i>
											</div>
											<div class="money">
												<span>$29.00</span>
											</div>
											<div class="incar">
												<a href="#" class="sui-btn btn-bordered btn-xlarge btn-default"><i class="car"></i><span class="cartxt">加入购物车</span></a>
											</div>
										</li>
										<li>
											<img src="./img/like2.png" />
											<div class="intro">
												<i>Apple苹果iPhone 6s (A1699)</i>
											</div>
											<div class="money">
												<span>$29.00</span>
											</div>
											<div class="incar">
												<a href="#" class="sui-btn btn-bordered btn-xlarge btn-default"><i class="car"></i><span class="cartxt">加入购物车</span></a>
											</div>
										</li>
										<li>
											<img src="./img/like3.png" />
											<div class="intro">
												<i>Apple苹果iPhone 6s (A1699)</i>
											</div>
											<div class="money">
												<span>$29.00</span>
											</div>
											<div class="incar">
												<a href="#" class="sui-btn btn-bordered btn-xlarge btn-default"><i class="car"></i><span class="cartxt">加入购物车</span></a>
											</div>
										</li>
										<li>
											<img src="./img/like4.png" />
											<div class="intro">
												<i>Apple苹果iPhone 6s (A1699)</i>
											</div>
											<div class="money">
												<span>$29.00</span>
											</div>
											<div class="incar">
												<a href="#" class="sui-btn btn-bordered btn-xlarge btn-default"><i class="car"></i><span class="cartxt">加入购物车</span></a>
											</div>
										</li>
									</ul>
								</div>
								<div class="item">
									<ul>
										<li>
											<img src="./img/like1.png" />
											<div class="intro">
												<i>Apple苹果iPhone 6s (A1699)</i>
											</div>
											<div class="money">
												<span>$29.00</span>
											</div>
											<div class="incar">
												<a href="#" class="sui-btn btn-bordered btn-xlarge btn-default"><i class="car"></i><span class="cartxt">加入购物车</span></a>
											</div>
										</li>
										<li>
											<img src="./img/like2.png" />
											<div class="intro">
												<i>Apple苹果iPhone 6s (A1699)</i>
											</div>
											<div class="money">
												<span>$29.00</span>
											</div>
											<div class="incar">
												<a href="#" class="sui-btn btn-bordered btn-xlarge btn-default"><i class="car"></i><span class="cartxt">加入购物车</span></a>
											</div>
										</li>
										<li>
											<img src="./img/like3.png" />
											<div class="intro">
												<i>Apple苹果iPhone 6s (A1699)</i>
											</div>
											<div class="money">
												<span>$29.00</span>
											</div>
											<div class="incar">
												<a href="#" class="sui-btn btn-bordered btn-xlarge btn-default"><i class="car"></i><span class="cartxt">加入购物车</span></a>
											</div>
										</li>
										<li>
											<img src="./img/like4.png" />
											<div class="intro">
												<i>Apple苹果iPhone 6s (A1699)</i>
											</div>
											<div class="money">
												<span>$29.00</span>
											</div>
											<div class="incar">
												<a href="#" class="sui-btn btn-bordered btn-xlarge btn-default"><i class="car"></i><span class="cartxt">加入购物车</span></a>
											</div>
										</li>
									</ul>
								</div>
							</div>
							<a href="#myCarousel" data-slide="prev" class="carousel-control left">‹</a>
							<a href="#myCarousel" data-slide="next" class="carousel-control right">›</a>
						</div>
					</div>
					<div id="profile" class="tab-pane">
						<p>特惠选购</p>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- 底部栏位 -->
	<!--页面底部-->
	<div id="foot"></div>
<!--页面底部END-->
<script type="text/javascript" src="js/all.js"></script>
<script type="text/javascript" src="admin/assets/layer/layer.js"></script>
<script>
	$("#head").load("include/head.html");
	$("#foot").load("include/foot.html");
</script>
<script type="text/javascript">
	$(function () {
		$(".chooseAll").click(function(){
			$("input[name='chk_list']").prop("checked", $(this).prop("checked"));
		});
		//用户id值的传入!
		var userId=1;
		// 页面加载时，根据登录号用户id从数据库拿取这个用户所有商品数据
		loads(userId);
	});
	function loads(userId) {
		$.ajax({ url:"/goodsFavourite/findAllByCondition",data:{"userId":userId,"statusId":1},success: function(data){
				//加载页面
				$(".cart-body").empty();
				moneys();
				exhibit(data);
			}});
	}
	//金钱的变化
	function money(this_1) {
			var id=$(this_1).parent().parent().find("input[name='chk_list']").val();
			var num=parseInt($(this_1).parent().find("input").val());
			var price=parseFloat($(this_1).parent().prev().find("span").text());
			var sum=parseFloat($(this_1).parent().next().find("span").text());
			var sums=parseFloat(price*num);
			$(this_1).parent().next().find("span").text(sums);
			moneys();
	};
	//选择的总金钱
	function moneys() {
		var number=0;
		var total_amount=0;
		var xuan=$("input[name='chk_list']");
		for (var i = 0; i <xuan.size(); i++) {
			if ($(xuan.get(i)).prop("checked")){
				var id=$(xuan.get(i)).val();
				number=number+parseInt($(xuan.get(i)).parent().parent().find(".itxt").val());
				total_amount=total_amount+parseInt($(xuan.get(i)).parent().parent().find(".sum").text());
				//根据id获取每单的数目以及每单的总价
			}
		}
		$(".chosed").text(number);
		$(".summoney").text("￥ "+total_amount);
	};
	//从数据库拿取商品数据展示页面
	function exhibit(data) {
		var tbody=$(".cart-body");
		for (var i = 0; i <data.length ; i++) {
			var showimg=data[i].goodsSku.showImg.split(",");
			var showimg_1=showimg[0].split("[");
			var param=data[i].goodsSku.params.split(";");
			// alert(showimg+":"+param);
			var param_1=param[0].split(",");
			tbody.append("<div class='cart-list'><ul class='goods-list yui3-g'><li class='yui3-u-1-24'>"+
					"<input type='checkbox' name='chk_list' name='' id='' value="+data[i].id+" /></li>"+
					"<li class='yui3-u-6-24'>"+
					"<div class='good-item'>"+
					"<div class='item-img'><img src="+showimg_1[0].toString()+"/></div>"+
					"<div class='item-msg'>"+data[i].goodsSku.title+"</div>"+
					"</div></li>"+
					"<li class='yui3-u-5-24'>"+
					"<div class='item-txt'>"+param_1[3].toString()+param_1[6].toString()+param_1[7].toString()+"</div>"+
					"</li>"+
					"<li class='yui3-u-1-8'><span class='price'>"+data[i].goodsSku.price+"</span></li>"+
					"<li class='yui3-u-1-8'>"+
					"<a href='javascript:void(0)' class='increment mins'>-</a>"+
					"<input autocomplete='off' type='text' value='1' minnum='1' class='itxt'/>"+
					"<a href='javascript:void(0)' class='increment plus'>+</a>"+
					"</li>"+
					"<li class='yui3-u-1-8'><span class='sum'>"+data[i].goodsSku.price+"</span></li>"+
					"<li class='yui3-u-1-8'>"+
					"<a class='cut_out' href=''>删除</a><br/>"+
					"<a href=''>移到收藏</a>"+
					"</li></ul></div>");
		};
		//删除点击时
		$(".cut_out").click(function () {
			var id=$(this).parent().parent().find("input[name='chk_list']").val();
			//根据商品id删除数据库数据
			// $.ajax({ url:"/goodsFavourite/findBySkuId",data:{"skuId":skuid}, success: function(datas){
					$.ajax({ url:"/goodsFavourite/deleteById",data:{"id":id}, success: function(data){
							//加载页面
							$(".cart-body").empty();
							//
							var userId=1;
							loads(userId);
						}});
				// }});
		});
		//删除所有选择商品
		$(".totalDelete").click(function () {
			var xuan=$("input[name='chk_list']");
			for (var i = 0; i <xuan.size(); i++) {
				if ($(xuan.get(i)).prop("checked")){
					var id=$(xuan.get(i)).val();
					//根据商品id删除数据库数据
					$.ajax({ url:"/goodsFavourite/deleteById",data:{"id":id}, success: function(data){
							//加载页面
							$(".cart-body").empty();
							//
							var userId=1;
							loads(userId);
						}});
				}
			}
		});
		//选择物品:单选
		$(".yui3-u-1-24").click(function () {
			var xuan=$("input[name='chk_list']");
			for (var i = 0; i <xuan.size(); i++) {
				if ($(xuan.get(i)).prop("checked")){
					var id=$(xuan.get(i)).val();
					$(".chooseAll").prop("checked",true);
					moneys();
				}else {
					$(".chooseAll").prop("checked",false);
					moneys();
				}
			}
		});
		//选择：全选
		$(".chooseAll").click(function () {
			var xuan=$("input[name='chk_list']");
			for (var i = 0; i <xuan.size(); i++) {
				if ($(xuan.get(i)).prop("checked")){
					var id=$(xuan.get(i)).val();
					moneys();
				}else {
					moneys();
				}
			}
		});
		//光标消失
		$(".itxt").blur(function () {
			// var value=parseInt($(this).val());
			var this_1=$(this);
			money(this_1);
		});
		//点击“+”号时
		$(".plus").click(function () {
			var this_1=$(this);
			var minnum=parseInt($(this).prev().attr("minnum"));
			var value=parseInt($(this).prev().val());
			minnum=minnum+1;
			value=value+1;
			// console.log(value)
			$(this).prev().attr("minnum",minnum);
			$(this).prev().val(value);
			money(this_1);
		});
		//点击“-”号时
		$(".mins").click(function () {
			var this_1=$(this);
			var minnum=parseInt($(this).next(".itxt").attr("minnum"));
			var value=parseInt($(this).next(".itxt").val());
			minnum=minnum-1;
			value=value-1;
			if (value==0){
				return;
			} else {
				$(this).next().attr("minnum",minnum);
				$(this).next().val(value);
				money(this_1);
			}
		});
		//点击结算
		$(".sum-btn").click(function () {
			var xuan=$("input[name='chk_list']");
			var ids=0;
			var nums=0;
			for (var i = 0; i <xuan.size(); i++) {
				if ($(xuan.get(i)).prop("checked")){
					var id=$(xuan.get(i)).val();
					var num=$(xuan.get(i)).parent().parent().find(".itxt").val()
					// alert(id+":"+num);
					ids=id+":"+ids;
					nums=num+":"+nums;
				}
			}
			// alert(ids+":"+nums);
			var href=$(this).attr("href");
			href=href+"?ids="+ids+"&nums="+nums;
			$(this).attr("href",href);
		});
	};
	//

</script>

</body>

</html>