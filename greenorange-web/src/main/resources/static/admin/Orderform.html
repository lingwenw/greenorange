<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN""http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta http-equiv="Cache-Control" content="no-siteapp"/>
    <link href="assets/css/bootstrap.min.css" rel="stylesheet"/>
    <link rel="stylesheet" href="css/style.css"/>
    <link href="assets/css/codemirror.css" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/ace.min.css"/>
    <link rel="stylesheet" href="font/css/font-awesome.min.css"/>
    <!--[if lte IE 8]>
    <link rel="stylesheet" href="assets/css/ace-ie.min.css"/>
    <![endif]-->
    <script src="js/jquery-1.9.1.min.js"></script>
    <script src="assets/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="js/H-ui.js"></script>
    <script src="assets/js/typeahead-bs2.min.js"></script>
    <script src="assets/js/jquery.dataTables.min.js"></script>
    <script src="assets/js/jquery.dataTables.bootstrap.js"></script>
    <script src="assets/layer/layer.js" type="text/javascript"></script>
    <script src="assets/laydate/laydate.js" type="text/javascript"></script>
    <script src="assets/js/jquery.easy-pie-chart.min.js"></script>
    <script src="js/lrtk.js" type="text/javascript"></script>
    <script type="text/javascript" src="../js/util.js"></script>
    <title>订单管理</title>
    <style type="text/css">
        #products_list {
            overflow: visible;
        }

        .pagination > li {
            cursor: pointer;
        }

        #sample-table {
            table-layout: fixed;
        }
    </style>
</head>

<body>
<div class="margin clearfix">
    <div class="Order_form clearfix" id="Order_form_style">
        <div class="title_name">购物产品所占比例
            <span class="top_show_btn Statistic_btn">显示</span>
            <span class="Statistic_title Statistic_btn"><a title="隐藏" class="top_close_btn">隐藏</a></span>
        </div>
        <div class="hide_style clearfix">
            <div class="proportion">
                <div class="easy-pie-chart percentage" data-percent="20" data-color="#D15B47"><span
                        class="percent">20</span>%
                </div>
                <span class="name">食品类</span></div>
            <div class="proportion">
                <div class="easy-pie-chart percentage" data-percent="55" data-color="#87CEEB"><span
                        class="percent">55</span>%
                </div>
                <span class="name">服装类</span></div>
            <div class="proportion">
                <div class="easy-pie-chart percentage" data-percent="90" data-color="#87B87F"><span
                        class="percent">90</span>%
                </div>
                <span class="name">数码配件</span></div>
            <div class="proportion">
                <div class="easy-pie-chart percentage" data-percent="30" data-color="#d63116"><span
                        class="percent">30</span>%
                </div>
                <span class="name">手机</span></div>
            <div class="proportion">
                <div class="easy-pie-chart percentage" data-percent="60" data-color="#ff6600"><span
                        class="percent">60</span>%
                </div>
                <span class="name">电脑</span></div>
            <div class="proportion">
                <div class="easy-pie-chart percentage" data-percent="40" data-color="#2ab023"><span
                        class="percent">40</span>%
                </div>
                <span class="name">电子产品</span></div>
            <div class="proportion">
                <div class="easy-pie-chart percentage" data-percent="46" data-color="#1e3ae6"><span
                        class="percent">46</span>%
                </div>
                <span class="name">厨房用品</span></div>
            <div class="proportion">
                <div class="easy-pie-chart percentage" data-percent="65" data-color="#c316a9"><span
                        class="percent">65</span>%
                </div>
                <span class="name">家用电器</span></div>
            <div class="proportion">
                <div class="easy-pie-chart percentage" data-percent="56" data-color="#13a9e1"><span
                        class="percent">56</span>%
                </div>
                <span class="name">卫浴</span></div>
        </div>
    </div>

    <!--订单表格-->
    <div class="order_list" id="order_list">
        <div class="h_products_list clearfix" id="products_list">
            <!--订单列表-->
            <div class="table_menu_list order_style" id="table_order_list" style="width: 100%;margin-left: 0;">
                <div class="search_style">
                    <div class="title_names">搜索查询</div>
                    <ul class="search_content clearfix">
                        <li><label class="l_f">订单编号:</label><input id="orderNum" type="text" class="text_add"
                                                                   placeholder="请输入订单编号" style=" width:250px">
                        </li>
                        <li><label class="l_f">起始时间：</label><input class="inline laydate-icon" id="startDate"
                                                                   style=" margin-left:10px;">
                        </li>
                        <li><label class="l_f">结束时间：</label><input class="inline laydate-icon" id="endDate"
                                                                   style=" margin-left:10px;">
                        </li>
                        <li><label class="l_f">用户id:</label><input id="userId" type="text" class="text_add"
                                                                   placeholder="请输入用户id" style=" width:150px">
                        </li>
                        <li>
                            <label>订单状态:
                                <select id="order_status" aria-controls="sample-table">
                                    <option value="请选择">请选择</option>
                                </select>
                            </label>
                        </li>
                        <li style="width:90px;">
                            <button type="button" class="btn_search"><i class="fa fa-search"></i>查询</button>
                        </li>
                    </ul>
                </div>
                <!--订单列表展示-->
                <table class="table table-striped table-bordered table-hover" id="sample-table">
                    <div class="row" style="margin-bottom: 15px">
                        <div class="col-sm-6">
                            <div class="dataTables_length" id="sample-table_length">
                                <label>每页显示条数:
                                    <select name="sample-table_length" aria-controls="sample-table" class="">
                                        <option value="3">3</option>
                                        <option value="5">5</option>
                                        <option value="10">10</option>
                                    </select>
                                </label></div>
                        </div>
                    </div>
                    <thead>
                    <tr>
                        <th width="25px"><label><input type="checkbox" class="ace"><span class="lbl"></span></label>
                        </th>
                        <th width="80px">订单编号</th>
                        <th width="250px">产品预览</th>
                        <th width="250px">产品名称</th>
                        <th width="80px">总价/元</th>
                        <th width="80px">收货人</th>
                        <th width="120px">收货电话</th>
                        <th width="130px">订单时间</th>
                        <th width="50px">总件数</th>
                        <th width="70px">状态</th>
                        <th width="150px">操作</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr v-for="item in pageInfo.list">
                        <td><label><input type="checkbox" class="ace"><span class="lbl"></span></label></td>
                        <td>{{item.id}}</td>
                        <td class="order_product_name">
                            {{initItemData(item)}}
                            <template v-for="(info, index) in item.res">
                                <a :href="'../goodsPage/'+info.id+'.html'" target="_blank">
                                    <img :src="'../img/goods_img/'+info.img" :title="info.title">
                                </a><i v-if="index!=item.res.length-1" class="fa fa-plus"></i>
                            </template>
                        </td>
                        <td>{{item.subject}}</td>
                        <td>{{item.price}}</td>
                        <td>{{item.address.contact}}</td>
                        <td>{{item.address.mobile}}</td>
                        <td>{{dateFormat(new Date(item.createTime))}}</td>
                        <td class="totol-count">{{item.count}}</td>
                        <td class="td-status"><span class="label label-success radius">{{item.statusName}}</span></td>
                        <td>
                            <a onclick="Delivery_stop(this,'10061')" href="javascript:;" title="发货"
                               class="btn btn-xs btn-success"><i class="fa fa-cubes bigger-120"></i></a>
                            <a title="订单详细" :href="'order_detailed.html?orderId='+item.id"
                               class="btn btn-xs btn-info order_detailed"><i class="fa fa-list bigger-120"></i></a>
                            <a title="删除" href="javascript:;" onclick="Order_form_del(this,'1')"
                               class="btn btn-xs btn-warning"><i class="fa fa-trash  bigger-120"></i></a>
                        </td>
                    </tr>
                    </tbody>
                </table>
                <div class="row">
                    <div class="col-sm-6">
                        <div class="dataTables_info" id="sample-table_info" role="status" aria-live="polite">
                            第 {{pageInfo.startRow}} 到 {{pageInfo.endRow}} 条记录，共 {{pageInfo.total}} 条记录, 共
                            {{pageInfo.pages}} 页
                        </div>
                    </div>
                    <div class="col-sm-6">
                        <div class="dataTables_paginate paging_bootstrap" id="sample-table_paginate">
                            <ul class="pagination">
                                <li id="goNum">
                                <span>跳至
                                    <input style="width: 50px" type="text" oninput="value=value.replace(/[^\d]/g,'')"> 页
                                </span>
                                    <a style="margin-right: 20px">确定</a>
                                </li>
                                <li @click="pageInfo.hasPreviousPage && getAllLimit(pageInfo.pageNum-1)"
                                    :class="[pageInfo.hasPreviousPage?'':'disabled','prev']"><a>上一页</a></li>
                                <li @click="nav!=pageInfo.pageNum && getAllLimit(nav)"
                                    v-for="nav in pageInfo.navigatepageNums" :class="nav==pageInfo.pageNum?'active':''">
                                    <a>{{nav}}</a></li>
                                <li @click="pageInfo.hasNextPage && getAllLimit(pageInfo.pageNum+1)"
                                    :class="[pageInfo.hasNextPage?'':'disabled','next']"><a>下一页</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!--发货-->
    <div id="Delivery_stop" style=" display:none">
        <div class="">
            <div class="content_style">
                <div class="form-group"><label class="col-sm-2 control-label no-padding-right"
                                               for="form-field-1">快递公司 </label>
                    <div class="col-sm-9"><select class="form-control" id="form-field-select-1">
                        <option value="">--选择快递--</option>
                        <option value="1">天天快递</option>
                        <option value="2">圆通快递</option>
                        <option value="3">中通快递</option>
                        <option value="4">顺丰快递</option>
                        <option value="5">申通快递</option>
                        <option value="6">邮政EMS</option>
                        <option value="7">邮政小包</option>
                        <option value="8">韵达快递</option>
                    </select></div>
                </div>
                <div class="form-group"><label class="col-sm-2 control-label no-padding-right" for="form-field-1">
                    快递号 </label>
                    <div class="col-sm-9"><input type="text" id="form-field-1" placeholder="快递号"
                                                 class="col-xs-10 col-sm-5" style="margin-left:0px;"></div>
                </div>
                <div class="form-group"><label class="col-sm-2 control-label no-padding-right"
                                               for="form-field-1">货到付款 </label>
                    <div class="col-sm-9"><label><input name="checkbox" type="checkbox" class="ace" id="checkbox"><span
                            class="lbl"></span></label></div>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
</html>
<script src="../js/vuejs-2.5.16.js"></script>
<script src="../js/axios-0.18.0.js"></script>
<script src="../js/vue-methods.js"></script>
<script src="../js/util.js"></script>
<script src="js/vue/orderForm.js"></script>
<script>
    //获得全部订单状态
    $("#order_status>option").data("id",null);
    $.get("../order/getAllOrderStatus",function (data) {
        $.errorAjax(data,function () {
            data.forEach( (e) => {
                let option = $('<option value="'+e.name+'">'+e.name+'</option>');
                option.data("id",e.id);
                $("#order_status").append(option);
            } )
            $("#order_status>option").click(function () {
                $("#order_status").data("statusId", $(this).data("id"));
            })
        })
    })

    //点击每页显示条数
    $("#sample-table_length select>option").click(function () {
        orderVue.getAllLimit(1);
    })

    //点击搜索按钮
    $(".btn_search").click(function () {
        orderVue.getAllLimit(1);
    })

    //点击跳转页码
    $("#goNum>a").click(function () {
        let pageNum = $("#goNum input").val();
        if (pageNum < 1) {
            return;
        }
        if (pageNum > orderVue.pageInfo.pages) {
            pageNum = orderVue.pageInfo.pages;
        }
        orderVue.getAllLimit(pageNum);
    })

    //顶部隐藏显示
    $(function () {
        $("#Order_form_style").fix({
            float: 'top',
            //minStatue : true,
            skin: 'green',
            durationTime: true,
            spacingw: 0,
            spacingh: 0,
            close_btn: '.top_close_btn',
            show_btn: '.top_show_btn',
            side_list: '.hide_style',
            close_btn_width: 80,
            side_title: '.Statistic_title',
        });
    });
    //时间选择
    laydate({
        elem: '#startDate',
        event: 'focus'
    });
    laydate({
        elem: '#endDate',
        event: 'focus'
    });

    /*订单-删除*/
    function Order_form_del(obj, id) {
        layer.confirm('确认要删除吗？', function (index) {
            $(obj).parents("tr").remove();
            layer.msg('已删除!', {icon: 1, time: 1000});
        });
    }

    /**发货**/
    function Delivery_stop(obj, id) {
        layer.open({
            type: 1,
            title: '发货',
            maxmin: true,
            shadeClose: false,
            area: ['500px', ''],
            content: $('#Delivery_stop'),
            btn: ['确定', '取消'],
            yes: function (index, layero) {
                if ($('#form-field-1').val() == "") {
                    layer.alert('快递号不能为空！', {
                        title: '提示框',
                        icon: 0,
                    })

                } else {
                    layer.confirm('提交成功！', function (index) {
                        $(obj).parents("tr").find(".td-manage").prepend('<a style=" display:none" class="btn btn-xs btn-success" onClick="member_stop(this,id)" href="javascript:;" title="已发货"><i class="fa fa-cubes bigger-120"></i></a>');
                        $(obj).parents("tr").find(".td-status").html('<span class="label label-success radius">已发货</span>');
                        $(obj).remove();
                        layer.msg('已发货!', {icon: 6, time: 1000});
                    });
                    layer.close(index);
                }

            }
        })
    };
    //面包屑返回值
    var index = parent.layer.getFrameIndex(window.name);
    parent.layer.iframeAuto(index);
    $('.Order_form,.order_detailed').on('click', function () {
        var cname = $(this).attr("title");
        var chref = $(this).attr("href");
        var cnames = parent.$('.Current_page').html();
        var herf = parent.$("#iframe").attr("src");
        parent.$('#parentIframe').html(cname);
        parent.$('#iframe').attr("src", chref).ready();
        ;
        parent.$('#parentIframe').css("display", "inline-block");
        parent.$('.Current_page').attr({"name": herf, "href": "javascript:void(0)"}).css({
            "color": "#4c8fbd",
            "cursor": "pointer"
        });
        //parent.$('.Current_page').html("<a href='javascript:void(0)' name="+herf+" class='iframeurl'>" + cnames + "</a>");
        parent.layer.close(index);

    });

    //初始化宽度、高度
    $(".hide_style").height($(".hide_style").height());
    var heights = $(".hide_style").outerHeight(true) + 90;
    $(".widget-box").height($(window).height() - heights);
    $(".table_menu_list").width($(window).width() - 20);
    $(".table_menu_list").height($(window).height() - heights);
    //当文档窗口发生改变时 触发
    $(window).resize(function () {
        $(".widget-box").height($(window).height() - heights);
        $(".table_menu_list").width($(window).width() - 20);
        $(".table_menu_list").height($(window).height() - heights);
    })
    //比例
    var oldie = /msie\s*(8|7|6)/.test(navigator.userAgent.toLowerCase());
    $('.easy-pie-chart.percentage').each(function () {
        $(this).easyPieChart({
            barColor: $(this).data('color'),
            trackColor: '#EEEEEE',
            scaleColor: false,
            lineCap: 'butt',
            lineWidth: 10,
            animate: oldie ? false : 1000,
            size: 103
        }).css('color', $(this).data('color'));
    });

    $('[data-rel=tooltip]').tooltip();
    $('[data-rel=popover]').popover({html: true});
</script>